// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  name      String
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}
model MaterialData {
  id           Int      @id @default(autoincrement())
  materialId   String
  materialName String
  location     String
  
  stokAwalOpr       Float
  stokAwalSap       Float
  stokAwalSelisih   Float
  stokAwalTotal     Float
  
  produksiOpr       Float
  produksiSap       Float
  produksiSelisih   Float
  produksiTotal     Float
  
  rilisOpr          Float
  rilisSap          Float
  rilisSelisih      Float
  rilisTotal        Float
  
  stokAkhirOpr      Float
  stokAkhirSap      Float
  stokAkhirSelisih  Float
  stokAkhirTotal    Float
  
  blank             Float
  blankTotal        Float
  grandTotal        Float
  
  importDate DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("material_data")
  @@index([materialId])
  @@index([location])
  @@index([importDate])
}

model Accrual {
  id             Int              @id @default(autoincrement())
  companyCode    String?
  noPo           String?
  kdAkr          String
  alokasi        String?
  kdAkunBiaya    String           @map("namaAkun")
  vendor         String
  deskripsi      String
  headerText     String?          // Header text untuk jurnal SAP
  klasifikasi    String?
  totalAmount    Float            // Total amount keseluruhan
  costCenter     String?
  startDate      DateTime         // Tanggal mulai periode pertama
  jumlahPeriode  Int              // Berapa bulan/periode
  pembagianType  String           @default("otomatis") // "otomatis" atau "manual"
  
  periodes       AccrualPeriode[] // Relasi ke detail periode
  
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  @@map("accruals")
  @@index([kdAkr])
  @@index([startDate])
}

model AccrualPeriode {
  id             Int                 @id @default(autoincrement())
  accrualId      Int
  accrual        Accrual             @relation(fields: [accrualId], references: [id], onDelete: Cascade)
  
  periodeKe      Int                 // 1, 2, 3, dst
  bulan          String              // "Jan 2026", "Feb 2026"
  tahun          Int                 // 2026
  amountAccrual  Float               // Nilai accrual periode ini
  
  realisasis     AccrualRealisasi[]  // Relasi ke realisasi
  
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt

  @@map("accrual_periodes")
  @@index([accrualId])
  @@index([bulan, tahun])
}

model AccrualRealisasi {
  id                Int              @id @default(autoincrement())
  accrualPeriodeId  Int
  accrualPeriode    AccrualPeriode   @relation(fields: [accrualPeriodeId], references: [id], onDelete: Cascade)
  
  tanggalRealisasi  DateTime
  amount            Float
  keterangan        String?
  
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  @@map("accrual_realisasis")
  @@index([accrualPeriodeId])
  @@index([tanggalRealisasi])
}