// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN_SYSTEM
  STAFF_ACCOUNTING
  SUPERVISOR_ACCOUNTING
  AUDITOR_INTERNAL
  STAFF_PRODUCTION
}

model User {
  id                 Int      @id @default(autoincrement())
  username           String   @unique
  email              String   @unique
  password           String
  name               String
  role               UserRole @default(STAFF_ACCOUNTING)
  isApproved         Boolean  @default(false)
  emailVerified      Boolean  @default(false)
  verificationToken  String?  @unique
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@map("users")
}
model MaterialData {
  id           Int      @id @default(autoincrement())
  materialId   String
  materialName String
  location     String
  
  stokAwalOpr       Float
  stokAwalSap       Float
  stokAwalSelisih   Float
  stokAwalTotal     Float
  
  produksiOpr       Float
  produksiSap       Float
  produksiSelisih   Float
  produksiTotal     Float
  
  rilisOpr          Float
  rilisSap          Float
  rilisSelisih      Float
  rilisTotal        Float
  
  stokAkhirOpr      Float
  stokAkhirSap      Float
  stokAkhirSelisih  Float
  stokAkhirTotal    Float
  
  blank             Float
  blankTotal        Float
  grandTotal        Float
  
  importDate DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("material_data")
  @@index([materialId])
  @@index([location])
  @@index([importDate])
}

model Accrual {
  id             Int              @id @default(autoincrement())
  companyCode    String?
  noPo           String?
  kdAkr          String
  alokasi        String?
  kdAkunBiaya    String           @map("namaAkun")
  vendor         String
  deskripsi      String
  headerText     String?          // Header text untuk jurnal SAP
  klasifikasi    String?
  totalAmount    Float            // Total amount keseluruhan
  costCenter     String?
  startDate      DateTime         // Tanggal mulai periode pertama
  jumlahPeriode  Int              // Berapa bulan/periode
  pembagianType  String           @default("otomatis") // "otomatis" atau "manual"
  
  periodes       AccrualPeriode[] // Relasi ke detail periode
  
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  @@map("accruals")
  @@index([kdAkr])
  @@index([startDate])
}

model AccrualPeriode {
  id             Int                 @id @default(autoincrement())
  accrualId      Int
  accrual        Accrual             @relation(fields: [accrualId], references: [id], onDelete: Cascade)
  
  periodeKe      Int                 // 1, 2, 3, dst
  bulan          String              // "Jan 2026", "Feb 2026"
  tahun          Int                 // 2026
  amountAccrual  Float               // Nilai accrual periode ini
  
  realisasis     AccrualRealisasi[]  // Relasi ke realisasi
  
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt

  @@map("accrual_periodes")
  @@index([accrualId])
  @@index([bulan, tahun])
}

model AccrualRealisasi {
  id                Int              @id @default(autoincrement())
  accrualPeriodeId  Int
  accrualPeriode    AccrualPeriode   @relation(fields: [accrualPeriodeId], references: [id], onDelete: Cascade)
  
  tanggalRealisasi  DateTime
  amount            Float
  keterangan        String?
  
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  @@map("accrual_realisasis")
  @@index([accrualPeriodeId])
  @@index([tanggalRealisasi])
}

model Prepaid {
  id             Int              @id @default(autoincrement())
  companyCode    String?
  noPo           String?
  kdAkr          String
  alokasi        String
  namaAkun       String
  vendor         String
  deskripsi      String?
  headerText     String?          // Header text untuk jurnal SAP
  klasifikasi    String?
  totalAmount    Float            // Total amount keseluruhan
  remaining      Float            // Sisa amount yang belum diamortisasi
  costCenter     String?
  startDate      DateTime         // Tanggal mulai periode pertama
  period         Int              // Berapa bulan/periode
  periodUnit     String           @default("bulan") // "bulan", "tahun", etc
  type           String           @default("Linear") // "Linear" atau "Verbal"
  pembagianType  String           @default("otomatis") // "otomatis" atau "manual"
  
  periodes       PrepaidPeriode[] // Relasi ke detail periode
  
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  @@map("prepaids")
  @@index([kdAkr])
  @@index([startDate])
}

model PrepaidPeriode {
  id             Int                  @id @default(autoincrement())
  prepaidId      Int
  prepaid        Prepaid              @relation(fields: [prepaidId], references: [id], onDelete: Cascade)
  
  periodeKe      Int                  // 1, 2, 3, dst
  bulan          String               // "Jan 2026", "Feb 2026"
  tahun          Int                  // 2026
  amountPrepaid  Float                // Nilai prepaid periode ini
  isAmortized    Boolean              @default(false) // Sudah diamortisasi atau belum
  amortizedDate  DateTime?            // Tanggal amortisasi
  
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt

  @@map("prepaid_periodes")
  @@index([prepaidId])
  @@index([bulan, tahun])
}